---
sidebar_position: 1
---

# Install

## Install by docker

### Pull image

```shell
docker pull openjob/openjob-server:latest
```

### Run container

Add a configuration file `.env`
```shell
OJ_DS_URL=jdbc:mysql://127.0.0.1:3306/openjob?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
OJ_LOG_STORAGE_MYSQL_URL=jdbc:mysql://127.0.0.1:3306/openjob?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
```

:::tip
Container runtime involves multiple parameter configurations. It is more convenient to use configuration files and parameters (environment variables) can also be passed at startup through naming conventions.
:::

Run Container

```shell
docker run --env-file .env -it -d -p 8080:8080 -p 25520:25520 openjob/openjob-server:latest /bin/bash
```



## Docker compose install

Create a new file `docker-compose.yml`
```yaml
version: '3'
services:
  openjob-server:
    image: openjob/openjob-server:latest
    restart: always
    container_name: openjob-server
    environment:
      - OJ_DS_URL=jdbc:mysql://172.20.0.235:3306/openjob?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
      - OJ_LOG_STORAGE_MYSQL_URL=jdbc:mysql://172.20.0.235:3306/openjob?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    ports:
      - "8080:8080"
      - "25520:25520"
```

Run container

```shell
# regular mode run
docker-compose up

# daemon mode run
docker-compose up -d
```
:::info
`docker-compose.yml` file directory executes the command to run the container.
:::

## General operations

### Container log

```shell
docker logs -f containerId
```

### Deployment structure
Enter the container.
```shell
docker exec -it containerId /bin/bash
```

The framework is deployed in the `/home/openjob` directory
```shell
|-- bin
|   |-- docker-startup.sh  # Docker startup script
|   |-- startup.bat  # Normal startup script (Windows)
|       |-- startup.sh # Normal startup script (Linux)
|-- conf
|   |-- application.properties # Configuration file
|       |-- logback.xml # Log configuration
|-- logs
|   |-- error.log # Error and warning logs
|   |-- notice.log # Running logs
|       |-- openjob_gc.log.0.current # GC logs
|-- target
        |-- openjob-server.jar # Startup jar
```

### Configuration Parameters

| Parameter Name | Default Value | Description |
|:----------|---------------------------------------------------------------------------------------------------------:|:--:|
| OJ_ADMIN_USER_PWD_SALT | ... | Encryption salt |
| OJ_DS_DRIVER_CLASS | `com.mysql.cj.jdbc.Driver`| Database driver, using MYSQL as default. |
| OJ_DS_URL | `jdbc:mysql://127.0.0.1:3306/openjob?...` | Database URL address |
| OJ_DS_USERNAME | root | Database account |
| OJ_DS_PASSWORD | 123456 | Database password |
| OJ_DS_HK_MINI_IDLE | 1 | Connection pool minimum idle number |
| OJ_DS_HK_MAX_POOL_SIZE | 10| Connection pool maximum number |
| OJ_DS_HK_IDLE_TIMEOUT | 60000 | Connection pool idle timeout |
| OJ_DS_HK_POOL_NAME | openjob | Connection pool name |
| OJ_FW_LOCATIONS | `classpath:db/migration/mysql` | The file used for migrating tables and structure, generated by MYSQL as default. |
| OJ_FW_TABLE | `migration_version` | The table name used for recording migration history during the process of migrating tables and structure. |
| OJ_LOG_STORAGE_SELECTOR | mysql | Log storage driver type, using MYSQL database as default. |
| OJ_LOG_STORAGE_H2_USER | root| H2 database log storage, database account. |
| OJ_LOG_STORAGE_H2_PASSWORD | 123456 | H2 database log storage, database password. |
| OJ_LOG_STORAGE_H2_URL | `jdbc:h2:mem:openjob;AUTO_RECONNECT=TRUE...`| H2 database log storage, database URL. |
| OJ_LOG_STORAGE_MYSQL_USER | root| MYSQL database log storage, database account. |
| OJ_LOG_STORAGE_MYSQL_PASSWORD | 123456 | MYSQL database log storage, database password. |
| OJ_LOG_STORAGE_MYSQL_URL | jdbc:mysql://127.0.0.1:3306/openjob?... | MYSQL database log storage, database URL. |
| OJ_SCHEDULER_DELAY_ENABLE | false | Configure the enabled status of delayed tasks, using `false` as default. |
| OJ_REDIS_HOST | `127.0.0.1` | Redis host |
| OJ_REDIS_PASSWORD | - | Redis password, using empty as default. |
| OJ_REDIS_DB  | 0 | Redis db |
| SPRING_JPA_SHOW_SQL  | false | SQL printing status, using `false` as default. |

:::tip
1. The container startup parameters are configured through environment variables.
2. Currently, only MySQL is supported as the database driver, and PostgreSQL/Oracle will be supported in the future.
3. Currently, log storage only supports H2/MYSQL, and elasticsearch/tidb/MongoDB will be supported in the future.
4. Delayed tasks are optional, but if enabled, Redis must be configured, otherwise the service cannot be used.
5. There are also some other parameters that are not configured through environment variables. If there is a scenario that needs to be modified, it can be achieved through file mounting.
:::